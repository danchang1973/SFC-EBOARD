# Uncomment these types if you want even more clean repository. But be careful.
# It can make harm to an existing project source. Read explanations below.
#
# Resource files are binaries containing manifest, project icon and version info.
# They can not be viewed as text or compared by diff-tools. Consider replacing them with .rc files.
#*.res
#
# Type library file (binary). In old Delphi versions it should be stored.
# Since Delphi 2009 it is produced from .ridl file and can safely be ignored.
#*.tlb
#
# Diagram Portfolio file. Used by the diagram editor up to Delphi 7.
# Uncomment this if you are not using diagrams or use newer Delphi version.
#*.ddp
#
# Visual LiveBindings file. Added in Delphi XE2.
# Uncomment this if you are not using LiveBindings Designer.
#*.vlb
#
# Deployment Manager configuration file for your project. Added in Delphi XE2.
# Uncomment this if it is not mobile development and you do not use remote debug feature.
#*.deployproj
#

# Delphi compiler-generated binaries (safe to delete)
*.exe
*.dll
*.bpl
*.bpi
*.dcp
*.so
*.apk
*.drc
*.map
*.dres
*.rsm
*.tds
*.dcu
*.lib

# Delphi autogenerated files (duplicated info)
*.cfg
*Resource.rc

# Delphi local files (user-specific info)
*.local
*.identcache
*.projdata
*.tvsconfig
*.dsk

# Delphi history and backups
__history/
*.~*

# Castalia statistics file
*.stat


unit sfc1;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, ExtCtrls, StdCtrls, DB, OleServer,ExcelXP, ADODB, Grids, DBGrids;

type
  TForm1 = class(TForm)
    Edit1: TEdit;
    Edit2: TEdit;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Timer1: TTimer;
    ADOConnection1: TADOConnection;
    ADOQuery1: TADOQuery;
    ADOQuery2: TADOQuery;
    Edit3: TEdit;
    Memo1: TMemo;
    ComboBox1: TComboBox;
    ComboBox2: TComboBox;
    Button2: TButton;
    DBGrid1: TDBGrid;
    DataSource1: TDataSource;
    Button3: TButton;
    Button4: TButton;
    Button1: TButton;
    Button5: TButton;
    Button6: TButton;
    Button7: TButton;
    ExcelApplication1: TExcelApplication;
    Timer2: TTimer;
    procedure Timer1Timer(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure Edit1Change(Sender: TObject);
    procedure BTCheckClick(Sender: TObject);
    procedure Edit3KeyPress(Sender: TObject; var Key: Char);
    procedure Edit1KeyPress(Sender: TObject; var Key: Char);
    procedure Button2Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
    procedure Button4Click(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure Button5Click(Sender: TObject);
    procedure Button6Click(Sender: TObject);
    procedure Button7Click(Sender: TObject);
    procedure Timer2Timer(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}

procedure TForm1.Timer1Timer(Sender: TObject);
begin
  Label3.caption:=datetimetostr(now);
end;

procedure TForm1.FormCreate(Sender: TObject);
begin

  Button5.Click;

//  ComboBox1.Items.Clear;
//  ComboBox2.Items.Clear;
  ADOQuery2.ACTIVE:=FALSE;
  ADOQuery2.SQL.Clear;
  ADOQuery2.SQL.add('select * from SFCSNTB');
  ADOQuery2.ACTIVE:=TRUE;
  ADOQuery2.FIRST;
  WHILE NOT ADOQuery2.EOF DO
    BEGIN
      ComboBox1.Items.Add(ADOQuery2.Fields.Fields[1].VALUE);
      ADOQuery2.NEXT;
    END;
{
  ADOQuery1.close;
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('select * from SFCLAYUPTC');
  ADOQuery1.ACTIVE:=TRUE;
  ADOQuery1.FIRST;
  WHILE NOT ADOQuery1.EOF DO
    BEGIN
      ComboBox2.Items.Add(ADOQuery1.Fields.Fields[1].VALUE);
      ADOQuery1.NEXT;
    END;

}
  ComboBox1.ItemIndex:=0;
  ComboBox2.ItemIndex:=0;

  ADOQuery2.ACTIVE:=FALSE;

end;


procedure TForm1.Edit1Change(Sender: TObject);
begin
  if length(edit1.text)>5 then
    begin
      edit2.text:='';
      edit2.setfocus;
    end;
end;

procedure TForm1.BTCheckClick(Sender: TObject);
var
  s:string;
begin
  ADOQuery1.close;
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('insert into SFCSNTA ( TB01, DT, SN, WN, TC01)');
  ADOQuery1.sql.add('values ( :TB01, :DT, :SN, :WN, :TC01) ');
  ADOQuery1.Parameters.ParamByName('TB01').Value:= ComboBox1.ItemIndex+101;
  ADOQuery1.Parameters.ParamByName('DT').Value:= STRTODATETIME(Label3.Caption);
  ADOQuery1.Parameters.ParamByName('SN').Value:= Edit2.Text;
  ADOQuery1.Parameters.ParamByName('WN').Value:= Edit3.Text;
  ADOQuery1.Parameters.ParamByName('TC01').Value:= ComboBox2.ItemIndex+201;
  ADOQuery1.ExecSQL;
  s:=ComboBox1.text + ' ' + Label3.Caption + ' ' + Edit2.Text + ' ' + Edit3.Text + ' ' + ComboBox2.text;
  memo1.Lines.Add(s);
end;

procedure TForm1.Edit3KeyPress(Sender: TObject; var Key: Char);
begin
 if key=#13 then
  begin
    if length(Edit3.text)=6 then
      begin
        edit1.Text:=edit3.Text;
        edit3.Text:='';
        edit3.SetFocus;
      end;
    if length(Edit3.text)=15 then
      begin
        edit2.Text:=edit3.Text;
        edit3.Text:='';
        edit3.SetFocus;
      end;
  end ;
end;

procedure TForm1.Edit1KeyPress(Sender: TObject; var Key: Char);
begin
 if key=#13 then
  begin
    if length(Edit1.text)=9 then
      begin
        edit3.Text:=edit1.Text;
      end;
    if length(Edit1.text)=15 then
      begin
        edit2.Text:=edit1.Text;
      end;
    if length(Edit1.text)=3 then
      begin
        if strtoint(edit1.text)<200 then
          begin
            ComboBox1.ItemIndex:=strtoint(edit1.text)-101;
          end;
        if (strtoint(edit1.text)>200) and (strtoint(edit1.text)<300) then
          begin
            ComboBox2.ItemIndex:=strtoint(edit1.text)-201;
          end;
      end;
    edit1.Text:='';
    edit1.SetFocus;
  end;  
end;

procedure TForm1.Button2Click(Sender: TObject);
begin
  ADOQuery1.close;
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('SELECT SFCSNTA.SN,SFCSNTB.TB01,SFCSNTA.DT,SFCSNTC.TC01,SFCSNTA.WN');
  ADOQuery1.SQL.add('FROM SFCSNTA,SFCSNTB,SFCSNTC');
  ADOQuery1.SQL.add('WHERE SN=:sn');
  ADOQuery1.SQL.add('AND SFCSNTA.TBID=SFCSNTB.ID');
  ADOQuery1.SQL.add('AND SFCSNTA.TCID=SFCSNTC.ID');
  ADOQuery1.SQL.add('ORDER BY DT');
  ADOQuery1.Parameters.parambyname('sn').VALUE:= Edit2.text;
  ADOQuery1.open;
end;

procedure TForm1.Button3Click(Sender: TObject);
begin
  ADOQuery1.close;
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('SELECT SFCSNTA.SN,SFCSNTB.TB01,SFCSNTA.DT,SFCSNTC.TC01,SFCSNTA.WN');
  ADOQuery1.SQL.add('FROM SFCSNTA,SFCSNTB,SFCSNTC');
  ADOQuery1.SQL.add('WHERE SN>:sn1');
  ADOQuery1.SQL.add('AND SN<:sn2');
  ADOQuery1.SQL.add('AND SFCSNTA.TBID=SFCSNTB.ID');
  ADOQuery1.SQL.add('AND SFCSNTA.TCID=SFCSNTC.ID');
  ADOQuery1.SQL.add('ORDER BY DT');
  ADOQuery1.Parameters.parambyname('sn1').VALUE:= 'W'+Edit3.text+'.....';
  ADOQuery1.Parameters.parambyname('sn2').VALUE:= 'W'+Edit3.text+'zzzzz';
  ADOQuery1.open;
end;

procedure TForm1.Button4Click(Sender: TObject);
begin
  ADOQuery1.close;
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('SELECT SFCSNTA.SN,SFCSNTB.TB01,SFCSNTA.DT,SFCSNTC.TC01,SFCSNTA.WN');
  ADOQuery1.SQL.add('FROM SFCSNTA,SFCSNTB,SFCSNTC');
  ADOQuery1.SQL.add('WHERE SN>:sn1');
  ADOQuery1.SQL.add('AND SN<:sn2');
  ADOQuery1.SQL.add('AND SFCSNTA.TBID=:ID');
  ADOQuery1.SQL.add('AND SFCSNTA.TBID=SFCSNTB.ID');
  ADOQuery1.SQL.add('AND SFCSNTA.TCID=SFCSNTC.ID');
  ADOQuery1.SQL.add('ORDER BY DT');
  ADOQuery1.Parameters.parambyname('sn1').VALUE:= 'W'+Edit3.text+'.....';
  ADOQuery1.Parameters.parambyname('sn2').VALUE:= 'W'+Edit3.text+'zzzzz';
  ADOQuery1.Parameters.parambyname('ID').VALUE:=ComboBox1.ItemIndex+101 ;
  ADOQuery1.open;
end;

procedure TForm1.Button1Click(Sender: TObject);
begin
  ADOQuery1.close;
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('SELECT SFCSNTA.SN,SFCSNTB.TB01,SFCSNTA.DT,SFCSNTC.TC01,SFCSNTA.WN');
  ADOQuery1.SQL.add('FROM SFCSNTA,SFCSNTB,SFCSNTC');
  ADOQuery1.SQL.add('WHERE SN>:sn1');
  ADOQuery1.SQL.add('AND SN<:sn2');
  ADOQuery1.SQL.add('AND SFCSNTA.TBID=:ID1');
  ADOQuery1.SQL.add('AND SFCSNTA.TCID=:ID2');
  ADOQuery1.SQL.add('AND SFCSNTA.TBID=SFCSNTB.ID');
  ADOQuery1.SQL.add('AND SFCSNTA.TCID=SFCSNTC.ID');
  if ComboBox2.ItemIndex=0 then
    begin
      ADOQuery1.SQL.add('AND SFCSNTA.OK=:OK');
      ADOQuery1.Parameters.parambyname('OK').VALUE:=0 ;
      ADOQuery1.Parameters.parambyname('ID2').VALUE:=ComboBox2.ItemIndex+201 ;
    end;
  if ComboBox2.ItemIndex=1 then
    begin
      ADOQuery1.Parameters.parambyname('ID2').VALUE:=ComboBox2.ItemIndex+201 ;
    end;
  ADOQuery1.SQL.add('ORDER BY DT');
  ADOQuery1.Parameters.parambyname('sn1').VALUE:= 'W'+Edit3.text+'.....';
  ADOQuery1.Parameters.parambyname('sn2').VALUE:= 'W'+Edit3.text+'zzzzz';
  ADOQuery1.Parameters.parambyname('ID1').VALUE:=ComboBox1.ItemIndex+101 ;
  ADOQuery1.open;
end;

procedure TForm1.Button5Click(Sender: TObject);
begin
  ADOQuery1.close;
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('SELECT SFCSNTA.SN,SFCSNTB.TB01,SFCSNTA.DT,SFCSNTC.TC01,SFCSNTA.WN');
  ADOQuery1.SQL.add('FROM SFCSNTA,SFCSNTB,SFCSNTC');
  ADOQuery1.SQL.add('WHERE SFCSNTA.TCID=:ID2');
  ADOQuery1.SQL.add('AND SFCSNTA.TBID=SFCSNTB.ID');  
  ADOQuery1.SQL.add('AND SFCSNTA.TCID=SFCSNTC.ID');
  ADOQuery1.SQL.add('AND SFCSNTA.OK=:OK');
  ADOQuery1.SQL.add('ORDER BY DT');
  ADOQuery1.Parameters.parambyname('OK').VALUE:=0 ;
  ADOQuery1.Parameters.parambyname('ID2').VALUE:=201 ;
  ADOQuery1.open;
end;

procedure TForm1.Button6Click(Sender: TObject);
begin
  ADOQuery1.close;
  ADOQuery1.SQL.Clear;
  ADOQuery1.SQL.add('SELECT SFCSNTA.SN,SFCSNTB.TB01,SFCSNTA.DT,SFCSNTC.TC01,SFCSNTA.WN');
  ADOQuery1.SQL.add('FROM SFCSNTA,SFCSNTB,SFCSNTC');
  ADOQuery1.SQL.add('WHERE SN>:sn1');
  ADOQuery1.SQL.add('AND SN<:sn2');
  ADOQuery1.SQL.add('AND SFCSNTA.TBID=:ID1');
  ADOQuery1.SQL.add('AND SFCSNTA.TCID=:ID2');
  ADOQuery1.SQL.add('AND SFCSNTA.TBID=SFCSNTB.ID');
  ADOQuery1.SQL.add('AND SFCSNTA.TCID=SFCSNTC.ID');
  if ComboBox2.ItemIndex=0 then
    begin
      ADOQuery1.SQL.add('AND SFCSNTA.OK=:OK');
      ADOQuery1.Parameters.parambyname('OK').VALUE:=0 ;
      ADOQuery1.Parameters.parambyname('ID2').VALUE:=ComboBox2.ItemIndex+201 ;
    end;
  if ComboBox2.ItemIndex=1 then
    begin
      ADOQuery1.Parameters.parambyname('ID2').VALUE:=ComboBox2.ItemIndex+201 ;
    end;
  ADOQuery1.SQL.add('ORDER BY DT');
  ADOQuery1.Parameters.parambyname('sn1').VALUE:= 'W'+Edit3.text+'.....';
  ADOQuery1.Parameters.parambyname('sn2').VALUE:= 'W'+Edit3.text+'zzzzz';
  ADOQuery1.Parameters.parambyname('ID1').VALUE:=ComboBox1.ItemIndex+101 ;
  ADOQuery1.open;
end;

procedure TForm1.Button7Click(Sender: TObject);
VAR
  asheet:variant;
  i,j,k:INTEGER;
begin
  ADOQuery1.First;
  ExcelApplication1.Visible[0]:=true;
  ExcelApplication1.Workbooks.Add(xlwbatworksheet,0);
  asheet:= ExcelApplication1.Worksheets.Item[1];
  asheet.cells[1,1].value:='S/N';
  asheet.cells[1,2].value:='站別';
  asheet.cells[1,3].value:='Date time';
  asheet.cells[1,4].value:='狀態';
  asheet.cells[1,5].value:='工號';

  FOR i := 1 to ADOQuery1.RecordCount do
    begin
      for j := 1 to 5  do
        begin
          asheet.cells[i+1,j].value:=ADOQuery1.Fields[j-1].Value;
        end;
      ADOQuery1.Next;
    end;
end;

procedure TForm1.Timer2Timer(Sender: TObject);
begin
  Button5.CLICK;  
end;

end.
